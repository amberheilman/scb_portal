<!DOCTYPE html>
<html>
  <head>
    <title>SCB Portal</title>
    <meta charset="utf-8" />
    <meta name="robots" content="noindex">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <style>
body {
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
  font-size: 1rem;
  font-weight: 400;
  line-height: 1.5;
  color: #212529;
}
a {
  color: #35abc5;
}
a:hover {
  color: black;
}
svg {
  vertical-align: text-top;
}
h3 {
  font-size: 1.5rem;
}
.btn{
  color: white;
  font-size: 25px;
  padding: 10px;
  background-color: #52bad1;
  font-size: 17.5px;
  font-weight: 500;
  font-style: normal;
  text-transform: none;
  letter-spacing: 0em;
  color: #eef7ef;
  background-color: #52bad1;
  border-color: #52bad1;
  border-radius: 300px;
  -webkit-box-shadow: 0 2px 0 0 #34abc5;
  -moz-box-shadow: 0 2px 0 0 #34abc5;
  box-shadow: 0 2px 0 0 #34abc5;
}
.small-button-style-raised .sqs-block-button .sqs-block-button-element--small,
.medium-button-style-raised .sqs-block-button .sqs-block-button-element--medium,
.large-button-style-raised .sqs-block-button .sqs-block-button-element--large {
    position: relative;
    -webkit-transition: .1s background-color linear;
    -moz-transition: .1s background-color linear;
    -o-transition: .1s background-color linear;
    transition: .1s background-color linear
}
.small-button-style-raised .sqs-block-button .sqs-block-button-element--small:active,
.medium-button-style-raised .sqs-block-button .sqs-block-button-element--medium:active,
.large-button-style-raised .sqs-block-button .sqs-block-button-element--large:active {
    top: 1px
}
.small-button-style-raised .sqs-block-button .sqs-block-button-element--small {
  -webkit-box-shadow: 0 2px 0 0 #34abc5;
  -moz-box-shadow: 0 2px 0 0 #34abc5;
  box-shadow: 0 2px 0 0 #34abc5
}
.small-button-style-raised .sqs-block-button .sqs-block-button-element--small:hover {
  background-color: #5ebed4
}
.small-button-style-raised .sqs-block-button .sqs-block-button-element--small:active {
  -webkit-box-shadow: 0 1px 0 0 #34abc5;
  -moz-box-shadow: 0 1px 0 0 #34abc5;
  box-shadow: 0 1px 0 0 #34abc5
}
.small-button-style-raised .sqs-alternate-block-style-container .sqs-block-button .sqs-block-button-element--small {
  -webkit-box-shadow: 0 2px 0 0 #ebebeb;
  -moz-box-shadow: 0 2px 0 0 #ebebeb;
  box-shadow: 0 2px 0 0 #ebebeb
}
.small-button-style-raised .sqs-alternate-block-style-container .sqs-block-button .sqs-block-button-element--small:hover {
  background-color: #fff
}
.small-button-style-raised .sqs-alternate-block-style-container .sqs-block-button .sqs-block-button-element--small:active {
  -webkit-box-shadow: 0 1px 0 0 #ebebeb;
  -moz-box-shadow: 0 1px 0 0 #ebebeb;
  box-shadow: 0 1px 0 0 #ebebeb
}
.small-button-shape-rounded .sqs-block-button .sqs-block-button-element--small,
.medium-button-shape-rounded .sqs-block-button .sqs-block-button-element--medium,
.large-button-shape-rounded .sqs-block-button .sqs-block-button-element--large {
  border-radius: 3px
}
.small-button-shape-pill .sqs-block-button .sqs-block-button-element--small,
.medium-button-shape-pill .sqs-block-button .sqs-block-button-element--medium,
.large-button-shape-pill .sqs-block-button .sqs-block-button-element--large {
  border-radius: 300px
}
.btn:hover {
  background-color: #5ebed4;
}
.transparent-btn {
  box-shadow: none;
  border: 2px solid #52bad1;
  color: #52bad1;
  background-color: transparent;
  -webkit-transition: background-color 170ms ease-out,color 170ms ease-out;
  -moz-transition: background-color 170ms ease-out,color 170ms ease-out;
  -ms-transition: background-color 170ms ease-out,color 170ms ease-out;
  -o-transition: background-color 170ms ease-out,color 170ms ease-out;
  transition: background-color 170ms ease-out,color 170ms ease-out;
  box-shadow: none;
  color: #52bad1;
  vertical-align: middle;
  padding: 12px 18px;
  margin: .618em .51em;
}
.transparent-btn:hover {
  cursor: pointer;
}
.img-previews {
  height: 100px;
  width: 100px;
}
.intake-images-container {
  display: flex;
  flex-wrap: wrap;
}
.intake-images-container img {
  margin: 1em;
  margin: 1em 0em 1em 1em;
}
.delete {
  margin-bottom: 97px;
  display: none;
}
.disable-div, .disable-div:hover {
  color: white;
  border-color: rgb(233, 236, 239);
  box-shadow: none;
  -webkit-box-shadow: none;
  -moz-box-shadow: none;
  background-color: #e9ecef;
}
.enable-div {
  background-color: #e9ecef;
  border-color: #52bad1;
  webkit-box-shadow: 0 2px 0 0 #34abc5;
  -moz-box-shadow: 0 2px 0 0 #34abc5;
  box-shadow: 0 2px 0 0 #34abc5;
}
.carousel-inner {
  background-color: #76c3d53d;
}
.search {
  padding: 0.4em;
  height: 45px;
  font-size: x-large;
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
}
.card-img-container {
  background-color: #76c3d53d;
}
.card-body-element {
  padding: 0.3em 0em 0.3em 0em;
}
.comment-container {
  border-left: 1px solid #dff0f4;
  margin: 0.5em;
  padding: 0.5em;
}
.mini-button {
  font-size: 15px;
}
.moreInfoBtn-container {
  margin: 1em 0 1em 0;
}
.foster-claim-button, .foster-claim-button:hover {
  background-color: #00b9fffa;
  border-color: #06a8e4fa;
  box-shadow: 0 2px 0 0 #06a8e4fa;
}
.foster-claim-button-active, .foster-claim-button-active:hover {
  background-color: #00b9ff29;
  border-color: #06a8e4fa;
  box-shadow: none;
  color: black;
}
.trap-claim-button, .trap-claim-button:hover {
  background-color: #ff4804bf;
  border-color: coral;
  box-shadow: 0 2px 0 0 #FF5722;
}
.trap-claim-button-active, .trap-claim-button-active:hover {
  background-color: #ff7f5017;
  border: 1px solid coral;
  box-shadow: none;
  color: black;
}
.read-more-link {
  margin: 0.5em;
  padding: 0.5em;
}
@media all and (max-width: 500px) {
  .search {
    margin-top: 2em;
  }
  .reverse {
    flex-wrap: wrap-reverse;
  }

}
    </style>
  </head>
  <body class="container-fluid">
    <main role="main">
      <section id="title" class="py-5 text-center container">
          <div class="d-flex justify-content-around align-items-center row reverse">
            <input type="text" id="search" class="search" placeholder="Search">
            <div id="unauthorizedBlock" style="display: none;">
              Please sign in to Google to get started: <button id="authorize_button" class="btn btn-secondary">Authorize</button>
            </div>
            <div id="authorizedBlock">
              <button id="signout_button" class="transparent-btn btn">Sign Out</button>
            </div>
        <pre id="error" style="white-space: pre-wrap;"></pre>
      </section>
      <div id="mainContainer">
        <ul class="nav nav-tabs" id="navTab" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" id="new-tab" href="#newEntries" role="tab" aria-controls="home" aria-selected="true">New</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="info-tab" href="#infoEntries" role="tab" aria-controls="profile" aria-selected="false">Requested Info</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="ready-tab" href="#readyEntries" role="tab" aria-controls="profile" aria-selected="false">Ready to Trap/Foster</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="completed-tab" href="#completedEntries" role="tab" aria-controls="contact" aria-selected="false">Completed</a>
          </li>
        </ul>
        <div class="tab-content" id="navTabContent">
          <div class="tab-pane fade show active" id="newEntries" role="tabpanel" aria-labelledby="new-tab">
            <div id="newEntryData"></div>
          </div>
          <div class="tab-pane fade" id="infoEntries" role="tabpanel" aria-labelledby="info-tab">
            <div id="needInfoData"></div>
          </div>
          <div class="tab-pane fade" id="readyEntries" role="tabpanel" aria-labelledby="ready-tab">
            <div id="readyForFostersData"></div>
          </div>
          <div class="tab-pane fade" id="completedEntries" role="tabpanel" aria-labelledby="completed-tab">
            <div id="completedData"></div>
          </div>
        </div>
      </div>

      <!-- <div id="catData"></div> -->

    </main>

<footer class="text-muted py-5">
  <div class="container">
    <p class="float-right mb-1">
      <a href="#">Back to top</a>
    </p>
  </div>
</footer>


<!-- modals -->
<div class="modal fade" id="detailsModal" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detailsModalLabel"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="modalDetailContainer">
          <h4>Notify</h4>
          <div id="notify-container" class="d-flex align-items-center">
            <!-- mailto links dynamically inserted here -->
          </div>
          <h4>Intake Information</h4>
          <form id="intakeStatusForm" style="padding-bottom: 0.5em; padding-top: 0.5em">
           <!-- form fields are dynamically inserted here -->
             <div class="form-group  mb-2 mr-sm-2">
                <label for="intakeTitle">Intake Title</label>
                <input type="textarea" id="intakeTitle" name="intakeTitle" class="form-control mb-2 mr-sm-2" disabled="">
             </div>
             <div class="form-group">
               <label for="taskList">What tasks are required?</label>
               <div id="taskList">
                 <div class="form-check">
                   <input class="form-check-input" type="checkbox" id="intakeNeedsFoster" disabled="" name="intakeNeedsFoster">
                   <label class="form-check-label" for="intakeNeedsFoster">
                     Needs fostering
                   </label>
                 </div>
                 <div class="form-check">
                   <input class="form-check-input" type="checkbox" id="intakeNeedsTrap" disabled="" name="intakeNeedsTrap">
                   <label class="form-check-label" for="intakeNeedsTrap">
                     Needs trapping
                   </label>
                 </div>
               </div>
             </div>
             <div class="form-group">
                <label for="intakeImages">Intake Images</label>
                <div id="intakeImages" class="intake-images-container">
                </div>
                <div id="uploadWidget" class="btn">+ Add Images</div>
               <input type="hidden" id="intakeImageURLs" name="imageURLs" />
             </div>
             <div class="form-group mb-2 mr-sm-2">
              <label for="intakeStatus">Intake Status</label>
                <select class="form-control mb-2 mr-sm-2 formDropdown" name="Intake Status" id="intakeStatus" disabled="">
                  <option value="new">New</option>
                  <option value="needsInfo">Requested Info</option>
                  <option value="ready">Ready for fosters</option>
                  <option value="completed">Completed</option>
                </select>
             </div>
                <div id="formButtonContainer" class="mb-2 mr-sm-2">
                  <div onclick="editIntakeStatus()" class="btn btn-primary" id="editContactButton">Edit</div>
                  <div onclick="saveIntakeStatus()" class="btn btn-success" id="saveContactButton" style="display: none;">Save</div>
                  <span id="formMessage"></span>
                </div>
          </form>
            <!-- hidden on load-->
          <h4>Details</h4>
          <div id="moreInfoContainer">
          </div>
        </div>
        <hr>
        <div id="modalCommentContainer">
          <h4>Comments</h4>
            <button id="commentButton" class="btn btn-primary" onclick="addComment()">Add New Comment</button>
            <span id="commentMessage"></span>
            <br>
            <div id="commentFormContainer">
              <form id="commentForm">
                <input type="hidden" class="form-control" name="commentUserName" id="commentUserName">
                <div class="form-group">
                  <label for="commentContent">Comment</label>
                  <input type="text" class="form-control" name="commentContent" id="commentContent">
                </div>
              </form>
              <button id="cancelCommentButton" class="btn btn-danger" onclick="cancelComment()">Cancel</button>
              <button id="saveCommentButton" class="btn btn-primary" onclick="saveComment()">Save Comment</button>
            </div>

          <div id="comments">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="deleteButton" class="btn btn-warning">Delete</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<!-- Image Carousel Modal -->
<div class="modal fade" id="imagesModal" tabindex="-1" role="dialog" aria-labelledby="imagesModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="imagesModalLabel"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="modalImagesContainer">
          <div id="carouselExampleIndicators" class="carousel" data-ride="carousel">
            <ol id="carouselIndicators" class="carousel-indicators">
              <!-- indicators added dynamically -->
            </ol>
            <div id="carouselInner" class="carousel-inner">
                <!-- images added dynamically -->
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev" onclick="$('#carouselExampleIndicators').carousel('prev')">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next" onclick="$('#carouselExampleIndicators').carousel('next')">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Handlebar templates -->
 <!-- <img src="{{images}}" style='width: 100%; height:225px; background:#55595c; color:#eceeef' class="card-img-top"> -->
<script id="newEntryDataTemplate" type="text/x-handlebars-template">
  <div class="album py-5 bg-light">
    <div id="newEntryDataContainer" class="container-fluid">
      <div class="row">
        {{#newEntryData}}
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <div id={{entryId}} onclick="openImagesModal(this, true)" class="card-img-container">
              {{#if images.[0]}}
                  <img src="{{images.[0]}}" style='width: 100%; height:250px; color:#eceeef; object-fit: scale-down' class="card-img-top">
              {{else}}
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/60/Cat_silhouette.svg/1078px-Cat_silhouette.svg.png" style='width: 100%; height:225px; background:#55595c; color:#eceeef; object-fit: scale-down;' class="card-img-top">
              {{/if}}
            </div>
            <div class="card-body">
              <div>
                <h3>{{[Intake Title]}}</h3>
              </div>
              <div style="margin: 1em 0 1em 0;">
                <small class="text-muted">Date Submitted: {{[submittedOn]}}</small>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-person-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M13.468 12.37C12.758 11.226 11.195 10 8 10s-4.757 1.225-5.468 2.37A6.987 6.987 0 0 0 8 15a6.987 6.987 0 0 0 5.468-2.63z"></path>
                  <path fill-rule="evenodd" d="M8 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
                  <path fill-rule="evenodd" d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"></path>
                </svg>
                <b>Name:</b> {{[Name]}}
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-geo" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M11 4a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"></path>
                  <path d="M7.5 4h1v9a.5.5 0 0 1-1 0V4z"></path>
                  <path fill-rule="evenodd" d="M6.489 12.095a.5.5 0 0 1-.383.594c-.565.123-1.003.292-1.286.472-.302.192-.32.321-.32.339 0 .013.005.085.146.21.14.124.372.26.701.382.655.246 1.593.408 2.653.408s1.998-.162 2.653-.408c.329-.123.56-.258.701-.382.14-.125.146-.197.146-.21 0-.018-.018-.147-.32-.339-.283-.18-.721-.35-1.286-.472a.5.5 0 1 1 .212-.977c.63.137 1.193.34 1.61.606.4.253.784.645.784 1.182 0 .402-.219.724-.483.958-.264.235-.618.423-1.013.57-.793.298-1.855.472-3.004.472s-2.21-.174-3.004-.471c-.395-.148-.749-.336-1.013-.571-.264-.234-.483-.556-.483-.958 0-.537.384-.929.783-1.182.418-.266.98-.47 1.611-.606a.5.5 0 0 1 .595.383z"></path>
                </svg>
                <b>Location:</b> <a href="https://www.google.com/maps/dir/Your+Location/{{#if [Location of cat(s), if different than your address]}}{{[Location of cat(s), if different than your address]}}{{else}}{{[Address]}}{{/if}}">{{#if [Location of cat(s), if different than your address]}}{{[Location of cat(s), if different than your address]}}{{else}}{{[Address]}}{{/if}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-telephone" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M3.925 1.745a.636.636 0 0 0-.951-.059l-.97.97c-.453.453-.62 1.095-.421 1.658A16.47 16.47 0 0 0 5.49 10.51a16.471 16.471 0 0 0 6.196 3.907c.563.198 1.205.032 1.658-.421l.97-.97a.636.636 0 0 0-.06-.951l-2.162-1.682a.636.636 0 0 0-.544-.115l-2.052.513a1.636 1.636 0 0 1-1.554-.43L5.64 8.058a1.636 1.636 0 0 1-.43-1.554l.513-2.052a.636.636 0 0 0-.115-.544L3.925 1.745zM2.267.98a1.636 1.636 0 0 1 2.448.153l1.681 2.162c.309.396.418.913.296 1.4l-.513 2.053a.636.636 0 0 0 .167.604L8.65 9.654a.636.636 0 0 0 .604.167l2.052-.513a1.636 1.636 0 0 1 1.401.296l2.162 1.681c.777.604.849 1.753.153 2.448l-.97.97c-.693.693-1.73.998-2.697.658a17.47 17.47 0 0 1-6.571-4.144A17.47 17.47 0 0 1 .639 4.646c-.34-.967-.035-2.004.658-2.698l.97-.969z"></path>
                </svg>
                <b>Phone:</b> <a href="tel:{{[Phone]}}">{{[Phone]}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-envelope-open" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M8.47 1.318a1 1 0 0 0-.94 0l-6 3.2A1 1 0 0 0 1 5.4v.818l5.724 3.465L8 8.917l1.276.766L15 6.218V5.4a1 1 0 0 0-.53-.882l-6-3.2zM15 7.388l-4.754 2.877L15 13.117v-5.73zm-.035 6.874L8 10.083l-6.965 4.18A1 1 0 0 0 2 15h12a1 1 0 0 0 .965-.738zM1 13.117l4.754-2.852L1 7.387v5.73zM7.059.435a2 2 0 0 1 1.882 0l6 3.2A2 2 0 0 1 16 5.4V14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5.4a2 2 0 0 1 1.059-1.765l6-3.2z"></path>
                </svg>
                <b>Email:</b> <a href="mailto:{{#if [Email Address]}}{{[Email Address]}}{{else}}{{[Email]}}{{/if}}">{{#if [Email Address]}}{{[Email Address]}}{{else}}{{[Email]}}{{/if}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"></path>
                  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"></path>
                </svg>
                <b>Comments:</b>
                  {{#if shortComments}}
                    <div>
                      {{#each shortComments as | comment |}}
                      <div class="comment-container">[<small>{{comment.[0]}}</small>] {{comment.[2]}} -- <b>{{comment.[1]}}</b></div>
                      {{/each}}
                    </div>
                    <a href="#" onclick="openMoreModal({{entryId}}, '#modalCommentContainer');" class="read-more-link"><small>View All Comments</small></a>
                  {{else}}
                   <small>N/A</small>
                  {{/if}}
              </div>
              <div class="d-flex justify-content-between align-items-center row moreInfoBtn-container">
                <div class="btn-group col-12">
                  <button id={{entryId}} type="button" class="btn btn-sm moreInfoBtn" onclick="openMoreModal({{entryId}})">More Info</button>
                  <!-- <button type="button" class="btn btn-sm btn-outline-secondary">Edit</button> -->
                </div>
              </div>
            </div>
          </div>
        </div>
        {{/newEntryData}}
      </div>
    </div>
  </div>
</script>

<script id="needInfoDataTemplate" type="text/x-handlebars-template">
  <div class="album py-5 bg-light">
    <div id="needInfoDataContainer" class="container-fluid">
      <div class="row">
        {{#needsInfoData}}
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <div id={{entryId}} onclick="openImagesModal(this, true)" class="card-img-container">
              {{#if images.[0]}}
                  <img src="{{images.[0]}}" style='width: 100%; height:250px; color:#eceeef; object-fit: scale-down' class="card-img-top">
              {{else}}
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/60/Cat_silhouette.svg/1078px-Cat_silhouette.svg.png" style='width: 100%; height:225px; background:#55595c; color:#eceeef; object-fit: scale-down;' class="card-img-top">
              {{/if}}
            </div>
            <div class="card-body">
              <div>
                <h3>{{[Intake Title]}}</h3>
              </div>
              <div style="margin: 1em 0 1em 0;">
                <small class="text-muted">Date Submitted: {{[submittedOn]}}</small>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-person-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M13.468 12.37C12.758 11.226 11.195 10 8 10s-4.757 1.225-5.468 2.37A6.987 6.987 0 0 0 8 15a6.987 6.987 0 0 0 5.468-2.63z"></path>
                  <path fill-rule="evenodd" d="M8 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
                  <path fill-rule="evenodd" d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"></path>
                </svg>
                <b>Name:</b> {{[Name]}}
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-geo" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M11 4a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"></path>
                  <path d="M7.5 4h1v9a.5.5 0 0 1-1 0V4z"></path>
                  <path fill-rule="evenodd" d="M6.489 12.095a.5.5 0 0 1-.383.594c-.565.123-1.003.292-1.286.472-.302.192-.32.321-.32.339 0 .013.005.085.146.21.14.124.372.26.701.382.655.246 1.593.408 2.653.408s1.998-.162 2.653-.408c.329-.123.56-.258.701-.382.14-.125.146-.197.146-.21 0-.018-.018-.147-.32-.339-.283-.18-.721-.35-1.286-.472a.5.5 0 1 1 .212-.977c.63.137 1.193.34 1.61.606.4.253.784.645.784 1.182 0 .402-.219.724-.483.958-.264.235-.618.423-1.013.57-.793.298-1.855.472-3.004.472s-2.21-.174-3.004-.471c-.395-.148-.749-.336-1.013-.571-.264-.234-.483-.556-.483-.958 0-.537.384-.929.783-1.182.418-.266.98-.47 1.611-.606a.5.5 0 0 1 .595.383z"></path>
                </svg>
                <b>Location:</b> <a href="https://www.google.com/maps/dir/Your+Location/{{#if [Location of cat(s), if different than your address]}}{{[Location of cat(s), if different than your address]}}{{else}}{{[Address]}}{{/if}}">{{#if [Location of cat(s), if different than your address]}}{{[Location of cat(s), if different than your address]}}{{else}}{{[Address]}}{{/if}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-telephone" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M3.925 1.745a.636.636 0 0 0-.951-.059l-.97.97c-.453.453-.62 1.095-.421 1.658A16.47 16.47 0 0 0 5.49 10.51a16.471 16.471 0 0 0 6.196 3.907c.563.198 1.205.032 1.658-.421l.97-.97a.636.636 0 0 0-.06-.951l-2.162-1.682a.636.636 0 0 0-.544-.115l-2.052.513a1.636 1.636 0 0 1-1.554-.43L5.64 8.058a1.636 1.636 0 0 1-.43-1.554l.513-2.052a.636.636 0 0 0-.115-.544L3.925 1.745zM2.267.98a1.636 1.636 0 0 1 2.448.153l1.681 2.162c.309.396.418.913.296 1.4l-.513 2.053a.636.636 0 0 0 .167.604L8.65 9.654a.636.636 0 0 0 .604.167l2.052-.513a1.636 1.636 0 0 1 1.401.296l2.162 1.681c.777.604.849 1.753.153 2.448l-.97.97c-.693.693-1.73.998-2.697.658a17.47 17.47 0 0 1-6.571-4.144A17.47 17.47 0 0 1 .639 4.646c-.34-.967-.035-2.004.658-2.698l.97-.969z"></path>
                </svg>
                <b>Phone:</b> <a href="tel:{{[Phone]}}">{{[Phone]}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-envelope-open" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M8.47 1.318a1 1 0 0 0-.94 0l-6 3.2A1 1 0 0 0 1 5.4v.818l5.724 3.465L8 8.917l1.276.766L15 6.218V5.4a1 1 0 0 0-.53-.882l-6-3.2zM15 7.388l-4.754 2.877L15 13.117v-5.73zm-.035 6.874L8 10.083l-6.965 4.18A1 1 0 0 0 2 15h12a1 1 0 0 0 .965-.738zM1 13.117l4.754-2.852L1 7.387v5.73zM7.059.435a2 2 0 0 1 1.882 0l6 3.2A2 2 0 0 1 16 5.4V14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5.4a2 2 0 0 1 1.059-1.765l6-3.2z"></path>
                </svg>
                <b>Email:</b> <a href="mailto:{{#if [Email Address]}}{{[Email Address]}}{{else}}{{[Email]}}{{/if}}">{{#if [Email Address]}}{{[Email Address]}}{{else}}{{[Email]}}{{/if}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"></path>
                  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"></path>
                </svg>
                <b>Comments:</b>
                  {{#if shortComments}}
                    <div>
                      {{#each shortComments as | comment |}}
                      <div class="comment-container">[<small>{{comment.[0]}}</small>] {{comment.[2]}} -- <b>{{comment.[1]}}</b></div>
                      {{/each}}
                    </div>
                    <a href="#" onclick="openMoreModal({{entryId}}, '#modalCommentContainer');" class="read-more-link"><small>View All Comments</small></a>
                  {{else}}
                   <small>N/A</small>
                  {{/if}}
              </div>
              <div class="d-flex justify-content-between align-items-center row moreInfoBtn-container">
                <div class="btn-group col-12">
                  <button id={{entryId}} type="button" class="btn btn-sm moreInfoBtn" onclick="openMoreModal({{entryId}})">More Info</button>
                  <!-- <button type="button" class="btn btn-sm btn-outline-secondary">Edit</button> -->
                </div>
              </div>
            </div>
          </div>
        </div>
        {{/needsInfoData}}
      </div>
    </div>
  </div>
</script>

<script id="readyForFostersDataTemplate" type="text/x-handlebars-template">
  <div class="album py-5 bg-light">
    <div id="readyForFostersContainer" class="container-fluid">
      <div class="row">
        {{#readyForFostersData}}
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <div id={{entryId}} onclick="openImagesModal(this, true)" class="card-img-container">
              {{#if images.[0]}}
                  <img src="{{images.[0]}}" style='width: 100%; height:250px; color:#eceeef; object-fit: scale-down' class="card-img-top">
              {{else}}
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/60/Cat_silhouette.svg/1078px-Cat_silhouette.svg.png" style='width: 100%; height:225px; background:#55595c; color:#eceeef; object-fit: scale-down;' class="card-img-top">
              {{/if}}
            </div>
            <div class="card-body">
              <div>
                <h3>{{[Intake Title]}}</h3>
              </div>
              <div style="margin: 1em 0 1em 0;">
                <small class="text-muted">Date Submitted: {{[submittedOn]}}</small>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-person-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M13.468 12.37C12.758 11.226 11.195 10 8 10s-4.757 1.225-5.468 2.37A6.987 6.987 0 0 0 8 15a6.987 6.987 0 0 0 5.468-2.63z"></path>
                  <path fill-rule="evenodd" d="M8 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
                  <path fill-rule="evenodd" d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"></path>
                </svg>
                <b>Name:</b> {{[Name]}}
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-geo" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M11 4a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"></path>
                  <path d="M7.5 4h1v9a.5.5 0 0 1-1 0V4z"></path>
                  <path fill-rule="evenodd" d="M6.489 12.095a.5.5 0 0 1-.383.594c-.565.123-1.003.292-1.286.472-.302.192-.32.321-.32.339 0 .013.005.085.146.21.14.124.372.26.701.382.655.246 1.593.408 2.653.408s1.998-.162 2.653-.408c.329-.123.56-.258.701-.382.14-.125.146-.197.146-.21 0-.018-.018-.147-.32-.339-.283-.18-.721-.35-1.286-.472a.5.5 0 1 1 .212-.977c.63.137 1.193.34 1.61.606.4.253.784.645.784 1.182 0 .402-.219.724-.483.958-.264.235-.618.423-1.013.57-.793.298-1.855.472-3.004.472s-2.21-.174-3.004-.471c-.395-.148-.749-.336-1.013-.571-.264-.234-.483-.556-.483-.958 0-.537.384-.929.783-1.182.418-.266.98-.47 1.611-.606a.5.5 0 0 1 .595.383z"></path>
                </svg>
                <b>Location:</b> <a href="https://www.google.com/maps/dir/Your+Location/{{#if [Location of cat(s), if different than your address]}}{{[Location of cat(s), if different than your address]}}{{else}}{{[Address]}}{{/if}}">{{#if [Location of cat(s), if different than your address]}}{{[Location of cat(s), if different than your address]}}{{else}}{{[Address]}}{{/if}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-telephone" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M3.925 1.745a.636.636 0 0 0-.951-.059l-.97.97c-.453.453-.62 1.095-.421 1.658A16.47 16.47 0 0 0 5.49 10.51a16.471 16.471 0 0 0 6.196 3.907c.563.198 1.205.032 1.658-.421l.97-.97a.636.636 0 0 0-.06-.951l-2.162-1.682a.636.636 0 0 0-.544-.115l-2.052.513a1.636 1.636 0 0 1-1.554-.43L5.64 8.058a1.636 1.636 0 0 1-.43-1.554l.513-2.052a.636.636 0 0 0-.115-.544L3.925 1.745zM2.267.98a1.636 1.636 0 0 1 2.448.153l1.681 2.162c.309.396.418.913.296 1.4l-.513 2.053a.636.636 0 0 0 .167.604L8.65 9.654a.636.636 0 0 0 .604.167l2.052-.513a1.636 1.636 0 0 1 1.401.296l2.162 1.681c.777.604.849 1.753.153 2.448l-.97.97c-.693.693-1.73.998-2.697.658a17.47 17.47 0 0 1-6.571-4.144A17.47 17.47 0 0 1 .639 4.646c-.34-.967-.035-2.004.658-2.698l.97-.969z"></path>
                </svg>
                <b>Phone:</b> <a href="tel:{{[Phone]}}">{{[Phone]}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-envelope-open" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M8.47 1.318a1 1 0 0 0-.94 0l-6 3.2A1 1 0 0 0 1 5.4v.818l5.724 3.465L8 8.917l1.276.766L15 6.218V5.4a1 1 0 0 0-.53-.882l-6-3.2zM15 7.388l-4.754 2.877L15 13.117v-5.73zm-.035 6.874L8 10.083l-6.965 4.18A1 1 0 0 0 2 15h12a1 1 0 0 0 .965-.738zM1 13.117l4.754-2.852L1 7.387v5.73zM7.059.435a2 2 0 0 1 1.882 0l6 3.2A2 2 0 0 1 16 5.4V14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5.4a2 2 0 0 1 1.059-1.765l6-3.2z"></path>
                </svg>
                <b>Email:</b> <a href="mailto:{{#if [Email Address]}}{{[Email Address]}}{{else}}{{[Email]}}{{/if}}">{{#if [Email Address]}}{{[Email Address]}}{{else}}{{[Email]}}{{/if}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"></path>
                  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"></path>
                </svg>
                <b>Comments:</b>
                  {{#if shortComments}}
                    <div>
                      {{#each shortComments as | comment |}}
                      <div class="comment-container">[<small>{{comment.[0]}}</small>] {{comment.[2]}} -- <b>{{comment.[1]}}</b></div>
                      {{/each}}
                    </div>
                    <a href="#" onclick="openMoreModal({{entryId}}, '#modalCommentContainer');" class="read-more-link"><small>View All Comments</small></a>
                  {{else}}
                   <small>N/A</small>
                  {{/if}}
              </div>
              <div class="d-flex justify-content-between align-items-center row moreInfoBtn-container">
                <div class="btn-group col-12">
                  <button id={{entryId}} type="button" class="btn btn-sm moreInfoBtn" onclick="openMoreModal({{entryId}})">More Info</button>
                  <!-- <button type="button" class="btn btn-sm btn-outline-secondary">Edit</button> -->
                </div>
              </div>
                {{#if [Intake Needs Foster]}}
                  <hr>
                {{/if}}
              {{#if [Intake Needs Trap]}}
                <div class="d-flex justify-content-between align-items-center row moreInfoBtn-container">
                  <div class="btn-group col-12">
                    {{#if [Intake Trapper]}}
                      <button id="trapClaimButton" type="button" class="btn btn-sm moreInfoBtn trap-claim-button-active" disabled="">
                        <b>
                          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-lightning-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"></path>
                          </svg> Trapper:
                        </b> {{[Intake Trapper]}}
                      </button>
                    {{else}}
                      <button id="trapClaimButton" type="button" class="btn btn-sm moreInfoBtn trap-claim-button" onclick="handleTrapClaim(this, {{entryId}})">I will trap!</button>
                    {{/if}}
                  </div>
                </div>
              {{/if}}
              {{#if [Intake Needs Foster]}}
                <div class="d-flex justify-content-between align-items-center row moreInfoBtn-container">
                  <div class="btn-group col-12">
                    {{#if [Intake Foster]}}
                      <button id="trapClaimButton" type="button" class="btn btn-sm moreInfoBtn foster-claim-button-active" disabled="">
                        <b>
                          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-house-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M8 3.293l6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6zm5-.793V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/>
                            <path fill-rule="evenodd" d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"/>
                          </svg> Foster:
                        </b> {{[Intake Foster]}}
                      </button>
                    {{else}}
                      <button id="fosterClaimButton" type="button" class="btn btn-sm moreInfoBtn foster-claim-button" onclick="handleFosterClaim(this, {{entryId}})">I will foster!</button>
                    {{/if}}
                  </div>
                </div>
              {{/if}}
            </div>
          </div>
        </div>
        {{/readyForFostersData}}
      </div>
    </div>
  </div>
</script>


<script id="completedDataTemplate" type="text/x-handlebars-template">
  <div class="album py-5 bg-light">
    <div id="completedDataContainer" class="container-fluid">
      <div class="row">
        {{#completedData}}
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <div id={{entryId}} onclick="openImagesModal(this, true)" class="card-img-container">
              {{#if images.[0]}}
                  <img src="{{images.[0]}}" style='width: 100%; height:250px; color:#eceeef; object-fit: scale-down' class="card-img-top">
              {{else}}
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/60/Cat_silhouette.svg/1078px-Cat_silhouette.svg.png" style='width: 100%; height:225px; background:#55595c; color:#eceeef; object-fit: scale-down;' class="card-img-top">
              {{/if}}
            </div>
            <div class="card-body">
              <div>
                <h3>{{[Intake Title]}}</h3>
              </div>
              <div style="margin: 1em 0 1em 0;">
                <small class="text-muted">Date Submitted: {{[submittedOn]}}</small>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-person-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M13.468 12.37C12.758 11.226 11.195 10 8 10s-4.757 1.225-5.468 2.37A6.987 6.987 0 0 0 8 15a6.987 6.987 0 0 0 5.468-2.63z"></path>
                  <path fill-rule="evenodd" d="M8 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
                  <path fill-rule="evenodd" d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"></path>
                </svg>
                <b>Name:</b> {{[Name]}}
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-geo" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M11 4a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"></path>
                  <path d="M7.5 4h1v9a.5.5 0 0 1-1 0V4z"></path>
                  <path fill-rule="evenodd" d="M6.489 12.095a.5.5 0 0 1-.383.594c-.565.123-1.003.292-1.286.472-.302.192-.32.321-.32.339 0 .013.005.085.146.21.14.124.372.26.701.382.655.246 1.593.408 2.653.408s1.998-.162 2.653-.408c.329-.123.56-.258.701-.382.14-.125.146-.197.146-.21 0-.018-.018-.147-.32-.339-.283-.18-.721-.35-1.286-.472a.5.5 0 1 1 .212-.977c.63.137 1.193.34 1.61.606.4.253.784.645.784 1.182 0 .402-.219.724-.483.958-.264.235-.618.423-1.013.57-.793.298-1.855.472-3.004.472s-2.21-.174-3.004-.471c-.395-.148-.749-.336-1.013-.571-.264-.234-.483-.556-.483-.958 0-.537.384-.929.783-1.182.418-.266.98-.47 1.611-.606a.5.5 0 0 1 .595.383z"></path>
                </svg>
                <b>Location:</b> <a href="https://www.google.com/maps/dir/Your+Location/{{#if [Location of cat(s), if different than your address]}}{{[Location of cat(s), if different than your address]}}{{else}}{{[Address]}}{{/if}}">{{#if [Location of cat(s), if different than your address]}}{{[Location of cat(s), if different than your address]}}{{else}}{{[Address]}}{{/if}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-telephone" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M3.925 1.745a.636.636 0 0 0-.951-.059l-.97.97c-.453.453-.62 1.095-.421 1.658A16.47 16.47 0 0 0 5.49 10.51a16.471 16.471 0 0 0 6.196 3.907c.563.198 1.205.032 1.658-.421l.97-.97a.636.636 0 0 0-.06-.951l-2.162-1.682a.636.636 0 0 0-.544-.115l-2.052.513a1.636 1.636 0 0 1-1.554-.43L5.64 8.058a1.636 1.636 0 0 1-.43-1.554l.513-2.052a.636.636 0 0 0-.115-.544L3.925 1.745zM2.267.98a1.636 1.636 0 0 1 2.448.153l1.681 2.162c.309.396.418.913.296 1.4l-.513 2.053a.636.636 0 0 0 .167.604L8.65 9.654a.636.636 0 0 0 .604.167l2.052-.513a1.636 1.636 0 0 1 1.401.296l2.162 1.681c.777.604.849 1.753.153 2.448l-.97.97c-.693.693-1.73.998-2.697.658a17.47 17.47 0 0 1-6.571-4.144A17.47 17.47 0 0 1 .639 4.646c-.34-.967-.035-2.004.658-2.698l.97-.969z"></path>
                </svg>
                <b>Phone:</b> <a href="tel:{{[Phone]}}">{{[Phone]}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-envelope-open" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M8.47 1.318a1 1 0 0 0-.94 0l-6 3.2A1 1 0 0 0 1 5.4v.818l5.724 3.465L8 8.917l1.276.766L15 6.218V5.4a1 1 0 0 0-.53-.882l-6-3.2zM15 7.388l-4.754 2.877L15 13.117v-5.73zm-.035 6.874L8 10.083l-6.965 4.18A1 1 0 0 0 2 15h12a1 1 0 0 0 .965-.738zM1 13.117l4.754-2.852L1 7.387v5.73zM7.059.435a2 2 0 0 1 1.882 0l6 3.2A2 2 0 0 1 16 5.4V14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5.4a2 2 0 0 1 1.059-1.765l6-3.2z"></path>
                </svg>
                <b>Email:</b> <a href="mailto:{{#if [Email Address]}}{{[Email Address]}}{{else}}{{[Email]}}{{/if}}">{{#if [Email Address]}}{{[Email Address]}}{{else}}{{[Email]}}{{/if}}</a>
              </div>
              <div class="card-body-element">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"></path>
                  <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"></path>
                </svg>
                <b>Comments:</b>
                  {{#if shortComments}}
                    <div>
                      {{#each shortComments as | comment |}}
                      <div class="comment-container">[<small>{{comment.[0]}}</small>] {{comment.[2]}} -- <b>{{comment.[1]}}</b></div>
                      {{/each}}
                    </div>
                    <a href="#" onclick="openMoreModal({{entryId}}, '#modalCommentContainer');" class="read-more-link"><small>View All Comments</small></a>
                  {{else}}
                   <small>N/A</small>
                  {{/if}}
              </div>
              <div class="d-flex justify-content-between align-items-center row moreInfoBtn-container">
                <div class="btn-group col-12">
                  <button id={{entryId}} type="button" class="btn btn-sm moreInfoBtn" onclick="openMoreModal({{entryId}})">More Info</button>
                  <!-- <button type="button" class="btn btn-sm btn-outline-secondary">Edit</button> -->
                </div>
              </div>
            </div>
          </div>
        </div>
        {{/completedData}}
      </div>
    </div>
  </div>
</script>

<!-- Handlebar template end -->


<!-- scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.5.3/handlebars.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
    <script>
      $('#navTab a').on('click', function (e) {
        e.preventDefault()
        $(this).tab('show')
      })
      $(document).ready(function(){
        $("#search").on("keyup", function() {
          var value = $(this).val().toLowerCase();
          $("#mainContainer").filter(function() {
            $("#mainContainer").find('.card').each(function() {
              if ($(this).text().toLowerCase().indexOf(value) > -1) {
                $(this).show();
              } else {
                $(this).hide();
              }
            });
          });
        });
        $(".tab-pane").click(function () {
           if ($('#search').val()) {
             var value = $(this).val().toLowerCase();
             $("#mainContainer").filter(function() {
             $("#mainContainer").find('.card').each(function() {
              if ($(this).text().toLowerCase().indexOf(value) > -1) {
                $(this).show();
              } else {
                $(this).hide();
              }
            });
           });
           }
        })
      });
    </script>
    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    <script>
const intakeSheetName = "Sheet1";


function displayError(message) {
  var pre = document.getElementById('error');
  var textContent = document.createTextNode(message + '\n');
  pre.appendChild(textContent);
}

function createRowObject(headers, row){
  let rowObject = {};
  for (let i= 0; i < headers.length; i++) {
    rowObject[headers[i]] = row[i];
  }
  if (!headers.includes('Intake Status')) {
    headers.push('Intake Status')
  }
  if (!rowObject['Intake Status']) {
    rowObject['Intake Status'] = 'new';
  }
  if (!rowObject['Timestamp']) {
    rowObject['entryId'] = new Date(rowObject['Submitted On']).getTime();
    rowObject['submittedOn'] = new Date(rowObject['Submitted On']);
  } else {
    rowObject['entryId'] = new Date(rowObject['Timestamp']).getTime();
    rowObject['submittedOn'] = new Date(rowObject['Timestamp']);
  }
  rowObject['comments'] = [];
  rowObject['shortComments'] = [];
  rowObject['images'] = [];
  rowObject['headers'] = headers;
  rowObject['Summary'] = "";

  for (let i= 0; i < headers.length; i++) {
      if (headers[i] == 'Intake Status') { continue; }
      if (headers[i] == 'Images' && row[i]) {
        rowObject['Summary'] += headers[i] + '%0A%20%20%20%20' + row[i].split("\n").join("%0A%0A%20%20%20%20") + '%0A%0A';
      } else {
        rowObject['Summary'] += headers[i] + '%0A%20%20%20%20' + row[i] + '%0A%0A';
      }
  }
  return rowObject;
}

function getSheetData() {
  gapi.client.sheets.spreadsheets.values.get({
    spreadsheetId: intakeSheetId,
    range: intakeSheetName,
  }).then(function(response) {
    var range = response.result;
    if (range.values.length > 0) {
      parseSheetData(range);
    } else {
      displayError('No data found.');
    }
  }, function(response) {
    displayError('Error: ' + response.result.error.message);
  });
}

function parseSheetData(response){
  let headers = response.values[0];
  response.values.shift();
  let sheetData = response.values;

  let rowDataObjectArray = [];

  //start counting at '2' since the first non-header row of Google sheet is at index 2
  let rowCounter = 2;
  sheetData.forEach(row => {
    if(row.length > 0){
      let newRow = createRowObject(headers, row);
      newRow.sheetIndex = rowCounter;
      rowDataObjectArray.push(newRow);
    }

    rowCounter++;
  })
  rowDataObjectArray = rowDataObjectArray.reverse();
  globalSheetData = rowDataObjectArray;
  getCommentData(rowDataObjectArray);
}

function getCommentData(sheetData){
  gapi.client.sheets.spreadsheets.values.get({
    spreadsheetId: commentSheetId,
    range: 'Form Responses 1',
  }).then(function(response) {
    var range = response.result;

    if (range.values.length > 0) {
      range.values.shift(); //remove headers from data

      let index = 2;
      range.values.forEach(comment => {

        let rowEntry = sheetData.find(x => x.entryId == comment[4]);
        if(rowEntry){
          comment.sheetIndex = index;
          rowEntry.comments.push(comment);
          if (rowEntry.shortComments.length < 2) {
            let shortComment = comment[2].slice(0, 100);
            if (comment[2].length > shortComment.length) {
              shortComment += '...';
            }
            rowEntry.shortComments.push([comment[0], comment[1], shortComment]);
          }
        }
        index++;
      })
    }
    getImageData(sheetData)
  }, function(response) {
    displayError('Error: ' + response.result.error.message);
    getImageData(sheetData)
  });
}

function getImageData(sheetData){
  sheetData.forEach(row => {
            let imageURLs = row['Images'];
            if (imageURLs) {
              imageURLs.split("\n").forEach(url => {
                if (url != "" && url.startsWith('http')) {
                  row.images.push(url)
                }
              })
            }
  })
  //form data for handlebars
  readyHandlebars(sheetData);
}


function readyHandlebars(data){

  let groupedByStatus = _.groupBy(data, function(entry){
    return entry['Intake Status']
  });

  var newEntrySource = document.getElementById("newEntryDataTemplate").innerHTML;
  var newEntryTemplate = Handlebars.compile(newEntrySource);
  var newEntryData = { newEntryData: groupedByStatus["new"]};
  var newEntryOutput = newEntryTemplate(newEntryData);
  document.getElementById("newEntryData").innerHTML = newEntryOutput;

  var needInfoSource = document.getElementById("needInfoDataTemplate").innerHTML;
  var needInfoTemplate = Handlebars.compile(needInfoSource);
  var needInfoData = { needsInfoData: groupedByStatus["needsInfo"]};
  var needInfoOutput = needInfoTemplate(needInfoData);
  document.getElementById("needInfoData").innerHTML = needInfoOutput;

  var readyForFostersSource = document.getElementById("readyForFostersDataTemplate").innerHTML;
  var readyForFostersTemplate = Handlebars.compile(readyForFostersSource);
  var readyForFostersData = { readyForFostersData: groupedByStatus["ready"]};
  var readyForFostersOutput = readyForFostersTemplate(readyForFostersData);
  document.getElementById("readyForFostersData").innerHTML = readyForFostersOutput;

  var completedSource = document.getElementById("completedDataTemplate").innerHTML;
  var completedTemplate = Handlebars.compile(completedSource);
  var completedData = { completedData: groupedByStatus["completed"]};
  var completedOutput = completedTemplate(completedData);
  document.getElementById("completedData").innerHTML = completedOutput;

  let urlParams = new URLSearchParams(window.location.search);
  let myParam = urlParams.get('tab');
  $('#navTab a[href="#'+myParam+'Entries"]').tab('show')
}

function getRowData(id){
  currentRowData = []; //clear row
  let rowEntry = globalSheetData.find(x => x.entryId == id);
  return rowEntry;
}


//used only for update form at the moment
function updateSheetRow(updateData, updateRange){
  let updateValues = [{
      range: updateRange,
      values: [updateData]
  }]
  gapi.client.sheets.spreadsheets.values.batchUpdate({
      spreadsheetId: intakeSheetId,
      valueInputOption: 'RAW'
      }, {'data': updateValues, }).then(function(response) {
        $('#formMessage').text("Save successful")
        $("#formMessage").show().delay(8000).queue(function (next) {
            $(this).hide();
            next();
        });
        $('#saveContactButton').hide();
        $('.formInput').prop("readonly", true);
        $('#uploadWidget').prop("disabled", true);

        $('#intakeStatus, #intakeTitle, #intakeNeedsFoster, #intakeNeedsTrap').prop("disabled", true);
        $('#editContactButton').text("Edit");
        getSheetData()

  }, function(err) {
      $('#formMessage').text("An error occurred, nothing was saved, please try again.")
      $("#formMessage").show().delay(8000).queue(function (next) {
          $(this).hide();
          next();
      });
      $('#saveContactButton').hide();
      $('.formInput').prop("readonly", true);
      $('#uploadWidget').prop("disabled", true);
      $('#intakeStatus, #intakeTitle, #intakeNeedsFoster, #intakeNeedsTrap').prop("disabled", true);
      $('#editContactButton').text("Edit");
  });
}

// images modal

function openImagesModal(buttonInfo) {
  let rowData = getRowData(buttonInfo.id);

  if(rowData == []){
    //return error
  }
  else {
    currentRowData = rowData;
    $('#imagesModal').modal({show: true});
  }
}

// on images modal show
$('#imagesModal').on('show.bs.modal', function (event) {
  var modal = $(this);
  modal.find('#carouselIndicators')[0].innerHTML = '';
  modal.find('#carouselInner')[0].innerHTML = '';
  for (let i = 0; i < currentRowData.images.length; i++) {
    let isActive = (i == 0 ) ? "active" : "";
    modal.find('#carouselIndicators')[0].innerHTML += `
        <li data-target="#carouselExampleIndicators" data-slide-to="${i}" class="${isActive}"></li>`;
    modal.find('#carouselInner')[0].innerHTML += `
              <div class="carousel-item ${isActive}">
                <img class="d-block w-100 h-50" style="max-height: 1000px; object-fit: scale-down;" src="${currentRowData.images[i]}" alt="">
              </div>`;
  }
});

function openMoreModal(buttonId, scrollElem){
  let rowData = getRowData(buttonId);

  if(rowData == []){
    //return error
  }
  else {
    currentRowData = rowData;
    $('#detailsModal').modal({show: true});
    if (scrollElem) {
      $('#detailsModal').on('shown.bs.modal', function (event) {
       $('#detailsModal').animate({scrollTop: $(scrollElem).offset().top}, 2000);
      });
    }
  }
}

//on modal show
$('#detailsModal').on('show.bs.modal', function (event) {
  var modal = $(this);
  modal.find('#moreInfoContainer')[0].innerHTML = '';
  $("#intakeTitle").val(currentRowData['Intake Title']);
  $("#intakeStatus").val(currentRowData['Intake Status']);
  if (currentRowData['Intake Needs Foster'] == "on") {
    $('#intakeNeedsFoster').val(currentRowData['Intake Needs Foster']);
    $('#intakeNeedsFoster').prop( "checked", true );
  }
  if (currentRowData['Intake Needs Trap'] == "on") {
    $('#intakeNeedsTrap').val(currentRowData['Intake Needs Trap']);
    $('#intakeNeedsTrap').prop( "checked", true );
  }
  for (let detail in currentRowData) {
    if (!["sheetIndex", "images", "comments", "entryId", "Intake Status",
          "Images", "headers", "Summary"].includes(detail)) {
      modal.find('#moreInfoContainer')[0].innerHTML += `
              <div class="form-group" style="padding-bottom: 0.5em;">
                <label for="{detail}">${detail}</label>
                <p style="background-color: #e9ecef; padding: 0.5em; border-radius: 0.5em;" id="${detail}">${currentRowData[detail]}</p>
              </div>`;
    }
  }
  resetImagesPreviews();

  $('#uploadWidget').addClass("disable-div");
  $('#saveContactButton').hide();

  $('#formMessage').hide();
  $('#commentFormContainer').hide();

  if(currentRowData['intakeStatus'] == "completed"){
    $('#editContactButton').hide();
    $('#imageButton').hide();
    $('#commentButton').hide();
    $('#deleteButton').show();
  }
  else {
    $('#editContactButton').show();
    $('#imageButton').show();
    $('#commentButton').show();
    $('#deleteButton').hide();
  }

  $('#commentUserName').val(gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getName());

  //get comments
  if(currentRowData.comments.length > 0){
    currentRowData.comments.forEach(comment => {
      modal.find('#comments').append('<div class="comment-container">[<small>'+ comment[0] + '</small>] ' + comment[2] + ' -- <b>' + comment[1] + '</b></div>')
    })
  }
  else{
     modal.find('#comments').append('<small>N/A</small>');
  }

  //get images
  if(currentRowData.images.length > 0){
    currentRowData.images.forEach(image => {
      modal.find('#modalImages').append('<img src="' + image + '" style="width: 100%; height:250px; color:#eceeef" class="col-lg-6">')
    })
  }
  else{
     modal.find('#modalImages').append('<p> No images yet </p>');
  }
});

//when modal hide
$('#detailsModal').on('hidden.bs.modal', function (event) {
  var modal = $(this);
  modal.find('#comments').empty();
  modal.find('#modalImages').empty();
  $('#intakeTitle').empty();
  $('#intakeNeedsFoster').empty();
  $('#intakeNeedsTrap').empty();
  $('.formInput').prop("readonly", true);
  $('#intakeStatus, #intakeTitle, #intakeNeedsFoster, #intakeNeedsTrap').prop("disabled", true);
  $('#uploadWidget').addClass("disable-div");
  $('#moreInfoButton').text("Show More");
  $('#editContactButton').text("Edit");
  $('#saveContactButton').hide();
  $('#formMessage').hide()
  $('#commentFormContainer').hide()
  $('#commentUserName').val("");
  $('#commentContent').val("");
});

function addComment(){
  $('#commentFormContainer').show();
  $('#commentButton').hide();
}

function cancelComment(){
  $('#commentUserName').val("");
  $('#commentContent').val("");
  $('#commentFormContainer').hide();
  $('#commentButton').show();
}

function saveComment(){

  let formData = $('#commentForm').serializeArray();

  let formDataObj = {}
  formData.forEach(entry => {
    formDataObj[entry.name] = entry.value;
  })

  let formDataArray = [];
  formDataArray.push(new Date().toLocaleString());
  formDataArray.push(formDataObj.commentUserName);
  formDataArray.push(formDataObj.commentContent);
  formDataArray.push(""); //empty for now, need to change sheet
  formDataArray.push(currentRowData.entryId);

  gapi.client.sheets.spreadsheets.values.append({
    spreadsheetId: commentSheetId,
    valueInputOption: 'RAW',
    range: 'A1'
    }, {'values': [formDataArray], }).then(function(response) {
      $('#commentMessage').text("Comment saved successfully.");
      $("#commentMessage").show().delay(8000).queue(function (next) {
        $(this).hide();
        next();
        });
      cancelComment();
      getSheetData();

  }, function(err) {
        cancelComment();
        $('#commentMessage').text("An error occurred, nothing was saved, please try again.")
        $("#commentMessage").show().delay(8000).queue(function (next) {
          $(this).hide();
          next();
          });
  });
}

function handleImageUploadClick(event) {
    cloudinary.createUploadWidget({
      cloudName: 'stray-cat-blues',
      uploadPreset: 'nqnjpbus',
      sources: ['local', 'camera']}, function(error, result) {
        if (!error && result && result.event === "success") {
            $('input[name="imageURLs"]').val( $('input[name="imageURLs"]').val() + result.info.secure_url + '\n');
            let index = $('input[name="imageURLs"]').val().split('http').filter(url => url.length > 0).length;
            $("#intakeImages").append('<div><img src="' + result.info.secure_url + '" class="img-previews">' +
                '<button id="imageDelete' + index + '" onclick="deleteImage(this, \'' + result.info.secure_url.trim() + '\')" type="button" class="delete close" aria-label="Delete" style="display: inline-block;>' +
                  '<span aria-hidden="true">&times;</span>' +
                '</button></div>');
        }
      }).open();
}

function handleTrapClaim(btn, entryId) {
  let name = gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getName();
  let rowData = getRowData(entryId);
  let updateRange = `AQ${rowData.sheetIndex}:AQ${rowData.sheetIndex}`;
  $(btn).replaceWith('<button id="trapClaimButton" type="button" class="btn btn-sm moreInfoBtn trap-claim-button"' +
          ' disabled=""><b><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-lightning-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">' +
          '  <path fill-rule="evenodd" d="M11.251.068a.5.5 0 0 1 .227.58L9.677 6.5H13a.5.5 0 0 1 .364.843l-8 8.5a.5.5 0 0 1-.842-.49L6.323 9.5H3a.5.5 0 0 1-.364-.843l8-8.5a.5.5 0 0 1 .615-.09z"></path>' +
          '</svg> Trapper:</b> ' + name +'</button>');
  updateSheetRow([name], updateRange);
}
function handleFosterClaim(btn, entryId) {
  let name = gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getName();
  let rowData = getRowData(entryId);
  let updateRange = `AP${rowData.sheetIndex}:AP${rowData.sheetIndex}`;
  $(btn).replaceWith('<button id="trapClaimButton" type="button" class="btn btn-sm moreInfoBtn foster-claim-button"' +
          ' disabled=""><b style=><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-house-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">' +
          '  <path fill-rule="evenodd" d="M8 3.293l6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6zm5-.793V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/>' +
          '  <path fill-rule="evenodd" d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"/>' +
          '</svg> Foster:</b> ' + name +'</button>');
    updateSheetRow([name], updateRange);
}

function resetImagesPreviews() {
    $('#intakeImages')[0].innerHTML = '';
    $('input[name="imageURLs"]').val('');
    for (let i=0; i < currentRowData['images'].length; i++) {
    if (currentRowData['images'][i] != "") {
      $("#intakeImages").append('<div><img src="' + currentRowData['images'][i] + '" class="img-previews">' +
          '<button id="imageDelete' + i + '" onclick="deleteImage(this, \'' + currentRowData['images'][i].trim() + '\')" type="button" class="delete close" aria-label="Delete">' +
          '  <span aria-hidden="true">&times;</span>' +
          '</button></div>');
      $('input[name="imageURLs"]').val($('input[name="imageURLs"]').val() + currentRowData['images'][i] + '\n');
    }
  }
}

function editIntakeStatus(){
    if($('#editContactButton')[0].innerText == "Edit"){
        $('#intakeStatus, #intakeTitle, #intakeNeedsFoster, #intakeNeedsTrap').prop('disabled', false);
        $('#uploadWidget').removeClass("disable-div");
        $('#editContactButton').text("Cancel Edit");
        $('#saveContactButton').show();
        $('.delete').show();
        document.getElementById("uploadWidget").addEventListener("click", handleImageUploadClick, false);
    }
    else {
        document.getElementById("uploadWidget").removeEventListener("click", handleImageUploadClick);
        $('#uploadWidget').addClass('disable-div');
        $('#intakeStatus, #intakeTitle, #intakeNeedsFoster, #intakeNeedsTrap').prop('disabled', true);
        $('#editContactButton').text("Edit");
        $('#saveContactButton').hide();
        $('.delete').hide();
        resetImagesPreviews();
    }
}

function saveIntakeStatus(){
  let formData = $('#intakeStatusForm').serializeArray();

  let formDataObj = {}
  formData.forEach(entry => {
    formDataObj[entry.name] = entry.value;
  })
  let formDataArray = [formDataObj['imageURLs'], formDataObj['Intake Status'],
    formDataObj['intakeTitle'], formDataObj['intakeNeedsFoster'], formDataObj['intakeNeedsTrap']];
  // currentRowData["headers"].forEach(header => {
  //   if (!["Timestamp"].includes(header)) {
  //     if (formDataObj[header] || formDataObj[header] == "") {
  //       formDataArray.push(formDataObj[header])
  //     } else {
  //       formDataArray.push(currentRowData[header])
  //     }
  //   }
  // })

  let updateRange = `AK${currentRowData.sheetIndex}:AO${currentRowData.sheetIndex}`;
  console.log(formData);
  console.log(updateRange);
  updateSheetRow(formDataArray, updateRange)

}

// function editForm(){
//     if($('#editContactButton')[0].innerText == "Edit"){
//         $('.formInput').prop('readonly', false);
//         $('.formDropdown').prop('disabled', false);
//         $('#editContactButton').text("Cancel Edit");
//         $('#saveContactButton').show();
//     }
//     else{
//         $('.formInput').prop('readonly', true);
//         $('.formDropdown').prop('disabled', true);
//         $('#editContactButton').text("Edit");
//         $('#saveContactButton').hide();
//     }
// }
//
// function saveForm(){
//   let formData = $('#moreInfoContainer').serializeArray();
//
//   let formDataObj = {}
//   formData.forEach(entry => {
//     formDataObj[entry.name] = entry.value;
//   })
//   let formDataArray = [];
//   currentRowData["headers"].forEach(header => {
//     if (!["Timestamp"].includes(header)) {
//       if (formDataObj[header] || formDataObj[header] == "") {
//         formDataArray.push(formDataObj[header])
//       } else {
//         formDataArray.push(currentRowData[header])
//       }
//     }
//   })
//
//   let updateRange = `B${currentRowData.sheetIndex}`
//   console.log(formDataArray);
//   console.log(updateRange);
//   updateSheetRow(formDataArray, updateRange)
//
// }

//delete entries
function deleteComments(){

  let rangesToDelete = currentRowData.comments.map(row => {
    return `A${row.sheetIndex}:ZZ${row.sheetIndex}`;
  });

  gapi.client.sheets.spreadsheets.values.batchClear({
    spreadsheetId: commentSheetId,
  }, { ranges: rangesToDelete}).then(function(response) {
     console.log(response);

  }, function(err) {
      console.log(err)
  });
}

function deleteImage(buttonElem, url){
    console.log(url);
    $('input[name="imageURLs"]').val($('input[name="imageURLs"]').val().replace(url, ''));
    $(buttonElem).parent().fadeOut();
}


//unused but could be useful later
// function updateSheetCell(updateData, updateRange) {
//   gapi.client.sheets.spreadsheets.values.update({
//     spreadsheetId: '1pFovhJ2zqoRvjsHiAwa5OIrYLnRXAMtlAcVXoxacp8E',
//     range: updateRange,
//     valueInputOption: 'RAW'
//   }, {values: [[updateData]]}).then(function(response) {
//       console.log(response);

//   }, function(err) {
//       console.log(err)
//     // displayError('Error: ' + response.result.error.message);
//   });
// }

// function updateEntryComments(entryId){
//   gapi.client.sheets.spreadsheets.values.get({
//     spreadsheetId: '1RwiQ3sI31swWW-oATinxsaGiCuhK4vfMzZoe-CnJZ1Q',
//     range: 'Form Responses 1',
//   }).then(function(response) {
//     var range = response.result;
//     if (range.values.length > 0) {
//       range.values.shift(); //remove headers from data
//       currentRowData.comments = [];
//       range.values.forEach(comment => {
//         if(comment[4] == entryId){
//           currentRowData.comments.push(comment)
//         }
//       })


//       $('#detailsModal').modal('hide');
//       $('#detailsModal').modal('show');

//       // console.log(currentRowData.comments)
//       // currentRowData.comments.forEach(comment => {
//       // $('#comments').append('<p>'+ comment[0] + '<br>' + comment[2] + '<br>' + comment[1] + '</p>')
//       // })
//     }
//   }, function(response) {
//     console.log(response)
//   });
// }
  </script>
    <script>
    // Client ID and API key from the Developer Console
var CLIENT_ID = '';
var API_KEY = '';

// Array of API discovery doc URLs for APIs used by the quickstart
var DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4", "https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];

// Authorization scopes required by the API; multiple scopes can be
// included, separated by spaces.
var SCOPES = "https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/drive.file";

var authorizeButton = document.getElementById('authorize_button');
var signoutButton = document.getElementById('signout_button');
var unauthorizedBlock= document.getElementById('unauthorizedBlock');
var authorizedBlock= document.getElementById('authorizedBlock');

let globalSheetData = {}; //local copy of intake form
let currentRowData = []; //local copy of current entry seen in modal

const intakeSheetId = "";
const commentSheetId = "";

/**
 *  On load, called to load the auth2 library and API client library.
 */
function handleClientLoad() {
  gapi.load('client:auth2', initClient);
}

/**
 *  Initializes the API client library and sets up sign-in state
 *  listeners.
 */
function initClient() {
  gapi.client.init({
    apiKey: API_KEY,
    clientId: CLIENT_ID,
    discoveryDocs: DISCOVERY_DOCS,
    scope: SCOPES
  }).then(function () {
    // Listen for sign-in state changes.
    gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

    // Handle the initial sign-in state.
    updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
    authorizeButton.onclick = handleAuthClick;
    signoutButton.onclick = handleSignoutClick;

  }, function(error) {
    displayError(JSON.stringify(error, null, 2));
  });
}

/**
 *  Called when the signed in status changes, to update the UI
 *  appropriately. After a sign-in, the API is called.
 */
function updateSigninStatus(isSignedIn) {
  if (isSignedIn) {
    unauthorizedBlock.style.display = "none";
    authorizedBlock.style.display = "block";
    document.getElementById("authorizedBlock").prepend("Hi, " + gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getGivenName() + "!");
    getSheetData();
  } else {
    unauthorizedBlock.style.display = "block";
    authorizedBlock.style.display = "none";
  }
}

/**
 *  Sign in the user upon button click.
 */
function handleAuthClick(event) {
  gapi.auth2.getAuthInstance().signIn();
}

/**
 *  Sign out the user upon button click.
 */
function handleSignoutClick(event) {
  gapi.auth2.getAuthInstance().signOut();
  $( "#mainContainer" ).empty();
}
  </script>
  </body>
</html>